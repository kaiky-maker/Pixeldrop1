<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagamento - TropFall</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: linear-gradient(180deg, #050b1b, #0a1328);
      color: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    .pix-box {
      background: rgba(255, 255, 255, 0.05);
      padding: 24px;
      border-radius: 16px;
      width: 380px;
      box-shadow: 0 8px 28px rgba(0,0,0,.5);
      text-align: center;
    }

    h2 {
      margin-bottom: 16px;
      font-weight: 700;
      color: #06b6d4;
    }

    .cart-items {
      text-align: left;
      font-size: 14px;
      margin-bottom: 10px;
      color: #d1d5db;
    }

    .total {
      font-size: 18px;
      font-weight: 600;
      margin-top: 10px;
      color: #fff;
    }

    .discount-info {
      background: rgba(34,197,94,0.1);
      border: 1px solid rgba(34,197,94,0.3);
      padding: 8px;
      border-radius: 8px;
      color: #4ade80;
      font-size: 13px;
      margin: 8px 0;
    }

    .qr {
      display: flex;
      justify-content: center;
      margin: 16px 0;
    }

    .pix-key-box {
      background: #0b1220;
      padding: 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      user-select: all;
    }

    .copy-btn {
      background: #06b6d4;
      color: #0a0a0a;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s ease;
    }

    .copy-btn:hover {
      background: #0ea5e9;
    }

    .back-btn {
      margin-top: 18px;
      background: transparent;
      border: 1px solid #06b6d4;
      color: #06b6d4;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      background: #06b6d4;
      color: #0a0a0a;
    }

    .muted {
      color: #9ca3af;
      font-size: 13px;
    }


    /* ======================== POP-UP ESTIL√ÉO ======================== */
    .popup-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 99999;
    }

    .popup-box {
      background: linear-gradient(180deg, #061226, #0c1b38);
      padding: 28px;
      width: 380px;
      border-radius: 16px;
      text-align: center;
      color: #fff;
      box-shadow: 0 0 25px rgba(0, 200, 255, .4);
      animation: pop .3s ease-out;
    }

    @keyframes pop {
      0% { transform: scale(0.6); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .popup-title {
      font-size: 20px;
      font-weight: 700;
      color: #06b6d4;
      margin-bottom: 12px;
    }

    .popup-discord {
      font-size: 26px;
      font-weight: 900;
      color: #38bdf8;
      text-shadow: 0 0 10px #38bdf8;
    }

    .popup-btn {
      margin-top: 18px;
      background: #06b6d4;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: 0.2s;
    }

    .popup-btn:hover {
      transform: scale(1.06);
      background: #0ea5e9;
    }

  </style>
</head>
<body>

  <!-- ================= POP-UP COMPLET√ÉO ================== -->
  <div class="popup-bg" id="popupAlert">
    <div class="popup-box">
      <div class="popup-title">‚ö† ATEN√á√ÉO ‚ö†</div>

      <p style="font-size:15px; margin-bottom:10px;">
        ENTRE NO NOSSO
        <br>
        <a href="https://discord.gg/seu-link-aqui" target="_blank" class="popup-discord">>DISCORD<</a>
        <br>
        PARA RECEBER O SEU PRODUTO!
      </p>

      <p style="font-size:14px; color:#cbd5e1; margin-bottom:10px;">
        LEIA ABAIXO DA CHAVE PIX PARA VER COMO RECEBER SEU PRODUTO.
      </p>

      <button class="popup-btn" onclick="document.getElementById('popupAlert').remove()">Entendi</button>
    </div>
  </div>
  <!-- ===================================================== -->


  <div class="pix-box">
    <h2>Pagamento PIX</h2>

    <div id="cartItems" class="cart-items"></div>

    <div id="discountInfo" class="discount-info" style="display:none;"></div>

    <div class="total">
      Total: <span id="totalValue">R$ 0,00</span>
    </div>

    <div class="qr">
      <img id="qrImage" src="assets/qrcode.png" alt="QR Code PIX" width="180" height="180">
    </div>

    <div class="pix-key-box">
      <span id="pixKey">b39fb7e6-09b8-4343-94a5-4f802bee4dd7</span>
      <button class="copy-btn" id="copyPix">Copiar</button>
    </div>

    <p class="muted" style="margin-top:10px;">Ap√≥s o pagamento, entre no nosso Discord e envie o comprovante no canal <strong>üì©„Éªabrir-ticket</strong>.</p>

    <button class="back-btn" onclick="window.location.href='index.html'">Voltar √† Loja</button>
  </div>

  <script>
    const formatBRL = (n) => n.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    const defaultPixKey = "b39fb7e6-09b8-4343-94a5-4f802bee4dd7";

    // --- L√™ o carrinho salvo ---
    const cartData = JSON.parse(localStorage.getItem("pixelDropCart") || '{"items":[],"total":0}');
    const cartEl = document.getElementById("cartItems");
    const totalEl = document.getElementById("totalValue");
    const discountEl = document.getElementById("discountInfo");

    let total = 0;
    let desconto = 0;
    let descontoPercent = 0;
    let usado = localStorage.getItem("cupomUsado");

    if (cartData.items && cartData.items.length > 0) {
      cartData.items.forEach(p => {
        const item = document.createElement("div");
        item.innerHTML = `‚Ä¢ ${p.name} x${p.qty || 1} ‚Äî ${formatBRL(p.price * (p.qty || 1))}`;
        cartEl.appendChild(item);
        total += p.price * (p.qty || 1);
      });

      // Detectar desconto
      if (cartData.total < total) {
        desconto = total - cartData.total;
        descontoPercent = Math.round((desconto / total) * 100);
        discountEl.innerHTML = `
          üè∑Ô∏è Usou cupom <strong>${usado || "desconhecido"}</strong> e ganhou <strong>${descontoPercent}%</strong> de desconto
          <br><span style="color:#86efac;">(Economizou ${formatBRL(desconto)})</span>
        `;
        discountEl.style.display = "block";
      }

      totalEl.textContent = formatBRL(cartData.total);
    } else {
      cartEl.textContent = "Carrinho vazio ou dados n√£o encontrados üò¢";
    }

    // --- Copiar chave PIX ---
    document.getElementById("pixKey").textContent = defaultPixKey;
    document.getElementById("copyPix").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(defaultPixKey);
        const btn = document.getElementById("copyPix");
        btn.textContent = "Copiado!";
        setTimeout(() => (btn.textContent = "Copiar"), 1500);
      } catch {
        alert("N√£o foi poss√≠vel copiar a chave PIX.");
      }
    });
  </script>
</body>
</html>
